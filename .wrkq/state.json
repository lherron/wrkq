{"meta":{"generated_at":"2025-12-06T03:33:03Z","machine_interface_version":1,"schema_version":1,"snapshot_rev":"sha256:f6392591b8fead5d71653aae637baa8b5af63577b9e23c95ef3be3cb09d52162"},"actors":{"4bcea916-b986-4c98-a96a-4e6204633a8c":{"created_at":"2025-11-23T17:29:57Z","display_name":"Local Human","id":"A-00001","role":"human","slug":"claude-code-agent","updated_at":"2025-11-23T17:29:57Z"}},"containers":{"1ce301dc-6405-4331-b09b-f32c337ebd58":{"created_at":"2025-11-30T18:58:14Z","created_by":"4bcea916-b986-4c98-a96a-4e6204633a8c","etag":1,"id":"P-00002","slug":"patch-mode","title":"patch-mode","updated_at":"2025-11-30T18:58:14Z","updated_by":"4bcea916-b986-4c98-a96a-4e6204633a8c"},"4ce44a72-873d-40f7-8164-7f87ad349f1e":{"created_at":"2025-11-23T17:29:57Z","created_by":"4bcea916-b986-4c98-a96a-4e6204633a8c","etag":1,"id":"P-00001","slug":"inbox","title":"Inbox","updated_at":"2025-11-23T17:29:57Z","updated_by":"4bcea916-b986-4c98-a96a-4e6204633a8c"}},"tasks":{"08ada2b3-e594-43e7-ae19-93e2d60e743d":{"completed_at":"2025-11-30T18:57:18Z","created_at":"2025-11-30T18:55:49Z","created_by":"4bcea916-b986-4c98-a96a-4e6204633a8c","description":"Update examples to show multi-line descriptions using -d flag.\nEnsure guidance remains clear.","etag":3,"id":"T-00003","priority":2,"project_uuid":"4ce44a72-873d-40f7-8164-7f87ad349f1e","slug":"update-wrkq-usage-multiline-examples","state":"completed","title":"Update WRKQ-USAGE examples for multi-line descriptions","updated_at":"2025-11-30T18:57:18Z","updated_by":"4bcea916-b986-4c98-a96a-4e6204633a8c"},"1307a61e-9957-4683-8657-a6cd2122108f":{"completed_at":"2025-12-04T16:18:33Z","created_at":"2025-12-04T16:16:24Z","created_by":"4bcea916-b986-4c98-a96a-4e6204633a8c","etag":2,"id":"T-00015","priority":3,"project_uuid":"4ce44a72-873d-40f7-8164-7f87ad349f1e","slug":"tree-open-flag","state":"completed","title":"Add --open flag to wrkq tree and hide archived by default","updated_at":"2025-12-04T16:18:33Z","updated_by":"4bcea916-b986-4c98-a96a-4e6204633a8c"},"1a0850e5-58dd-4f8c-8db1-a5496cfd81e5":{"completed_at":"2025-12-03T16:30:12Z","created_at":"2025-12-03T16:24:11Z","created_by":"4bcea916-b986-4c98-a96a-4e6204633a8c","description":"Implement REFACTOR.md #1 (CLI bootstrap/context).\nGoal: centralize config.Load, DB open, and actor resolution into a reusable helper (e.g., internal/cli/appctx) so commands stop repeating this logic. Ensure --db overrides are honored, DB closes centrally, and error text references WRKQ_ACTOR/WRKQ_ACTOR_ID (not TODO_ACTOR). Provide a wrapper to inject context into commands (e.g., withApp(run func(ctx *App,...))). Update several commands to use it and keep behavior parity.\nFiles likely: internal/cli/*.go, internal/config, internal/actors, internal/cli/helpers.go (remove/adjust resolveCurrentActor). Tests: go test ./internal/cli ./internal/config ./internal/actors. Add notes in REFACTOR.md if scope changes.","etag":5,"id":"T-00011","priority":3,"project_uuid":"4ce44a72-873d-40f7-8164-7f87ad349f1e","slug":"refactor-cli-bootstrap","state":"completed","title":"Share CLI bootstrap for config/DB/actor","updated_at":"2025-12-03T16:55:21Z","updated_by":"4bcea916-b986-4c98-a96a-4e6204633a8c"},"1d07efa8-7981-4caf-b322-420bb7878bb7":{"completed_at":"2025-12-03T18:12:14Z","created_at":"2025-12-03T16:24:23Z","created_by":"4bcea916-b986-4c98-a96a-4e6204633a8c","description":"Implement REFACTOR.md #3 (store/service layer).\nGoal: create internal/store (or similar) with typed services for tasks/containers/attachments/comments that perform DB ops, bump etags, manage timestamps, and log events. Commands should delegate to store methods instead of raw SQL, reducing duplication in set/touch/mkdir/attach/etc. Ensure event payloads are structured (no hand-built JSON strings). Maintain behavior parity.\nFiles likely: internal/store/*, refactors in internal/cli/{set,touch,mkdir,attach,comment,bundle?}, internal/events. Tests: go test ./internal/store ./internal/cli ./internal/events.\nCapture follow-ups in REFACTOR.md if scope adjusts.","etag":3,"id":"T-00013","priority":3,"project_uuid":"4ce44a72-873d-40f7-8164-7f87ad349f1e","slug":"store-layer","state":"completed","title":"Introduce store layer with etags/events","updated_at":"2025-12-03T18:12:14Z","updated_by":"4bcea916-b986-4c98-a96a-4e6204633a8c"},"25414357-ed78-4aaf-bcb9-b56ee3b1a980":{"completed_at":"2025-11-30T19:09:01Z","created_at":"2025-11-30T18:58:22Z","created_by":"4bcea916-b986-4c98-a96a-4e6204633a8c","description":"Deliver wrkqadm state export/import/verify per docs/PATCH-MODE.md §2 \u0026 §5.1–5.3. Must:\n- Export canonical .wrkq/state.json (JCS ordering, omit null/empty, sorted arrays, deterministic timestamps) with meta.snapshot_rev = sha256(canonical bytes).\n- Import snapshots with --if-empty / --force, dry-run validation, and truncation/restore path; persist snapshot_rev in DB meta.\n- Verify round-trip determinism: import to temp DB, re-export canonical, byte-compare; exit 4 on mismatch with diagnostics.\n- Flags: --canonical (default true), --include-events, --out/--from, --dry-run, --json summary counts.\n- Exit codes: 0 ok, 1 IO/DB, 2 usage, 4 conflict/invariants.\n- Tests covering canonicalization, omit rules, snapshot_rev hashing, and verify failures.","etag":4,"id":"T-00004","priority":2,"project_uuid":"1ce301dc-6405-4331-b09b-f32c337ebd58","slug":"state-snapshot-cli","state":"completed","title":"Add canonical state snapshot export/import/verify to wrkqadm","updated_at":"2025-11-30T19:09:01Z","updated_by":"4bcea916-b986-4c98-a96a-4e6204633a8c"},"265b2780-0f26-4974-9308-166580a33438":{"completed_at":"2025-12-03T17:06:21Z","created_at":"2025-12-03T16:24:17Z","created_by":"4bcea916-b986-4c98-a96a-4e6204633a8c","description":"Implement REFACTOR.md #2 (path/selector reuse).\nGoal: add shared resolver(s) to handle container/task traversal and slug normalization once (e.g., selectors.ResolveContainerPath/ResolveTaskPath). Replace bespoke SQL path walks in commands (mkdir, touch, ls, tree, mv, cp, etc.). Keep error messages consistent with slug rules. Consider createParents option for mkdir -p. Ensure selectors keeps friendly ID lookups working.\nFiles likely: internal/selectors, internal/paths, internal/cli/{mkdir,touch,ls,tree,mv,cp}. Tests: go test ./internal/selectors ./internal/paths ./internal/cli. Document any changed error strings.","etag":5,"id":"T-00012","priority":3,"project_uuid":"4ce44a72-873d-40f7-8164-7f87ad349f1e","slug":"resolvers-unification","state":"completed","title":"Unify container/task path resolution","updated_at":"2025-12-06T03:32:19Z","updated_by":"4bcea916-b986-4c98-a96a-4e6204633a8c"},"4caa8a16-31c1-4843-9d0d-fbfb0a1e854d":{"completed_at":"2025-11-30T21:20:50Z","created_at":"2025-11-30T18:58:38Z","created_by":"4bcea916-b986-4c98-a96a-4e6204633a8c","description":"Update SPEC/docs for patch-first workflow per docs/PATCH-MODE.md §§6–7.\n- Document repo invariants: main authoritative .wrkq/state.json, patches/\u003cbranch\u003e.json must equal diff(main snapshot → branch snapshot); optional patches/applied history.\n- Developer flow: export snapshot, create patch, pre-commit verification (state verify, patch validate), sample commands.\n- CI flow: recompute patch \u0026 diff check, strict validate/apply dry-run, rebase if main advanced, integration tests; include exit code expectations.\n- Transition guidance: coexistence with bundle flow, adoption steps, compatibility notes, recommended hooks.\n- Provide PR-ready examples/snippets and clarify required flags and file locations.","etag":4,"id":"T-00008","priority":3,"project_uuid":"1ce301dc-6405-4331-b09b-f32c337ebd58","slug":"patch-mode-workflow-docs-ci","state":"completed","title":"Document patch-first workflow and CI hooks","updated_at":"2025-11-30T21:20:50Z","updated_by":"4bcea916-b986-4c98-a96a-4e6204633a8c"},"5e0013db-5352-43c6-bdd1-4635d2999fb1":{"completed_at":"2025-11-30T18:26:47Z","created_at":"2025-11-30T16:06:59Z","created_by":"4bcea916-b986-4c98-a96a-4e6204633a8c","description":"Improve init command: use .env over .env.local, overwrite WRKQ-USAGE.md, avoid duplicate CLAUDE.md directives, support AGENTS.md","etag":2,"id":"T-00002","priority":3,"project_uuid":"4ce44a72-873d-40f7-8164-7f87ad349f1e","slug":"wrkqadm-init-improvements","state":"completed","title":"Updates to wrkqadm init command","updated_at":"2025-11-30T18:26:47Z","updated_by":"4bcea916-b986-4c98-a96a-4e6204633a8c"},"83f16658-c686-4d79-962b-eb770cf60826":{"completed_at":"2025-11-23T18:28:13Z","created_at":"2025-11-23T18:25:30Z","created_by":"4bcea916-b986-4c98-a96a-4e6204633a8c","description":"Update wrkqadm init to:\n- Embed WRKQ-USAGE.md in the wrkqadm binary\n- Write WRKQ-USAGE.md to project directory during init\n- Check CLAUDE.md and add @WRKQ-USAGE.md reference at top if missing","etag":2,"id":"T-00001","priority":3,"project_uuid":"4ce44a72-873d-40f7-8164-7f87ad349f1e","slug":"wrkqadm-init-write-docs","state":"completed","title":"wrkqadm init should write WRKQ-USAGE.md and update CLAUDE.md","updated_at":"2025-11-23T18:28:13Z","updated_by":"4bcea916-b986-4c98-a96a-4e6204633a8c"},"9ad5e73c-259a-4778-a2f3-f00b8da2db7a":{"completed_at":"2025-11-30T21:12:08Z","created_at":"2025-11-30T18:58:26Z","created_by":"4bcea916-b986-4c98-a96a-4e6204633a8c","description":"Implement RFC6902 pipeline per docs/PATCH-MODE.md §3 \u0026 §§5.4–5.6.\n- Canonical diff: from snapshot A to B using UUID paths, normalized ops (no redundant replace/add/remove), optional --allow-noncanonical.\n- Validate: apply patch in memory, enforce schema + domain invariants (FKs, DAG acyclic, slug uniqueness, no completed task with open deps, friendly ID uniqueness), fail in --strict with exit 4.\n- Apply: export current DB snapshot, optional --if-match snapshot_rev guard, apply patch, validate, transactional minimal DB updates, --dry-run mode (no writes).\n- Flags: patch file/base file, --strict, --if-match, --dry-run, --json (counts of ops/adds/replaces/removes or apply result).\n- Exit codes: 0 ok, 1 IO/DB, 2 usage, 4 validation/conflict.\n- Tests: diff normalization, invalid path cases, invariant failures, snapshot_rev mismatch, dry-run vs write path.","etag":4,"id":"T-00005","priority":2,"project_uuid":"1ce301dc-6405-4331-b09b-f32c337ebd58","slug":"patch-create-validate-apply","state":"completed","title":"Implement JSON patch create/validate/apply pipeline","updated_at":"2025-11-30T21:12:08Z","updated_by":"4bcea916-b986-4c98-a96a-4e6204633a8c"},"a54c46d2-b8ee-41eb-bbff-3845bb399869":{"completed_at":"2025-12-03T18:24:41Z","created_at":"2025-12-03T16:24:27Z","created_by":"4bcea916-b986-4c98-a96a-4e6204633a8c","description":"Implement REFACTOR.md #4 (cursor pagination helper).\nGoal: wire cursor.BuildWhereClause into actual queries so pagination happens in SQL, not in-memory filtering. Add helper (e.g., cursor.Apply) to append WHERE/ORDER/LIMIT and generate next cursor. Update commands using pagination (ls, find, comment ls, attach ls, log, maybe watch) to use it. Keep ordering semantics and porcelain next_cursor output.\nFiles likely: internal/cursor, internal/cli/{ls,find,comment.go,attach.go,log.go,watch?}. Tests: go test ./internal/cursor ./internal/cli; add targeted tests for pagination paths.","etag":3,"id":"T-00014","priority":3,"project_uuid":"4ce44a72-873d-40f7-8164-7f87ad349f1e","slug":"sql-cursor-pagination","state":"completed","title":"SQL-backed cursor pagination","updated_at":"2025-12-03T18:24:41Z","updated_by":"4bcea916-b986-4c98-a96a-4e6204633a8c"},"cd114f93-2927-4566-ad7f-12c4c1cab26c":{"completed_at":"2025-11-30T21:15:46Z","created_at":"2025-11-30T18:58:30Z","created_by":"4bcea916-b986-4c98-a96a-4e6204633a8c","description":"Deliver wrkqadm patch rebase (docs/PATCH-MODE.md §5.7 \u0026 §4.4) with deterministic friendly-ID auto-renumber.\n- Inputs: patch, old-base snapshot, new-base snapshot; compute branch state = apply(patch, old).\n- For each resource type (tasks/containers/comments/actors): detect new entities, compare friendly IDs against new-base, resolve collisions via width-preserving increment (prefix + zero_pad(max+1)) in stable order.\n- Support --strict-ids to fail on malformed IDs; otherwise allow fallback.\n- Emit rebased canonical patch via diff(new-base, rebased state); --json includes op counts and code_rewrites mapping UUID -\u003e {from,to}.\n- Exit codes: 0 ok, 1 IO, 2 usage, 4 invalid patch or strict ID failure.\n- Tests: collisions across multiple types, stable ordering, malformed ID strictness, idempotent rebase when no changes.","etag":4,"id":"T-00006","priority":2,"project_uuid":"1ce301dc-6405-4331-b09b-f32c337ebd58","slug":"patch-rebase-auto-renumber","state":"completed","title":"Add patch rebase with friendly ID auto-renumber","updated_at":"2025-11-30T21:15:46Z","updated_by":"4bcea916-b986-4c98-a96a-4e6204633a8c"},"d773bfbd-771e-4038-ac8f-090216fca8bf":{"completed_at":"2025-11-30T21:19:17Z","created_at":"2025-11-30T18:58:33Z","created_by":"4bcea916-b986-4c98-a96a-4e6204633a8c","description":"Add wrkqadm patch summarize (docs/PATCH-MODE.md §5.8) producing human/agent friendly deltas.\n- Formats: text, markdown, json; optional base snapshot to enrich context (titles/slugs/paths) while keeping UUID anchor.\n- Output groups ops by entity with counts and concise rows (id, op, key fields; Markdown table example in spec). Keep deterministic ordering.\n- Flags: --patch, --base (optional), --format text|markdown|json.\n- Exit codes: 0 ok, 1 IO, 2 usage.\n- Tests: coverage for each format, missing base fallback, empty patch handling, deterministic ordering.","etag":4,"id":"T-00007","priority":3,"project_uuid":"1ce301dc-6405-4331-b09b-f32c337ebd58","slug":"patch-summarize","state":"completed","title":"Add wrkqadm patch summarize command","updated_at":"2025-11-30T21:19:17Z","updated_by":"4bcea916-b986-4c98-a96a-4e6204633a8c"},"e596575a-b1bb-4668-955d-5d5ea47794b9":{"completed_at":"2025-12-03T16:20:08Z","created_at":"2025-12-03T16:15:13Z","created_by":"4bcea916-b986-4c98-a96a-4e6204633a8c","description":"User request (Dec 3 2025): review codebase and propose consolidations and refactorings. Deliver recommendations in REFACTOR.md.","etag":3,"id":"T-00010","priority":2,"project_uuid":"4ce44a72-873d-40f7-8164-7f87ad349f1e","slug":"refactor-review","state":"completed","title":"Review codebase and recommend consolidations/refactorings","updated_at":"2025-12-03T16:20:08Z","updated_by":"4bcea916-b986-4c98-a96a-4e6204633a8c"}},"comments":{"0a25e5af-366b-44c7-855b-7d2afe98a39a":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Completed. Added --open flag and changed default to hide archived. Changes in internal/cli/tree.go.","created_at":"2025-12-04 16:18:33","etag":1,"id":"C-00018","task_uuid":"1307a61e-9957-4683-8657-a6cd2122108f"},"19fcbe2e-3a8d-4c30-9460-9b300a100335":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Completed RFC 6902 JSON Patch pipeline implementation.\n\n**Files created:**\n- `internal/patch/types.go` - RFC 6902 Operation/Patch types, options, results\n- `internal/patch/diff.go` - Compute patches between snapshots (UUID paths, normalized ops)\n- `internal/patch/apply.go` - Apply patches to snapshots/databases  \n- `internal/patch/validate.go` - Domain invariant validation (FKs, cycles, slug uniqueness, ID uniqueness)\n- `internal/cli/patchadm.go` - CLI: `wrkqadm patch create`, `validate`, `apply`\n- `internal/patch/patch_test.go` - Comprehensive tests\n\n**Features:**\n- Patch create: diff snapshots, normalize ops (add/remove/replace)\n- Patch validate: apply in-memory, check FK refs, cycles, slug/ID uniqueness\n- Patch apply: --if-match snapshot_rev guard, --dry-run, --strict, transactional DB update\n- All exit codes per spec (0 ok, 1 IO/DB, 2 usage, 4 conflict)\n\nAll tests passing. Ready for T-00006 (patch rebase with auto-renumber).","created_at":"2025-11-30 21:12:08","etag":1,"id":"C-00006","task_uuid":"9ad5e73c-259a-4778-a2f3-f00b8da2db7a"},"2e9bad45-5cbc-4cd1-8673-8951ce542571":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Completed. Updated wrkqadm init: (1) prefers .env over .env.local, (2) overwrites WRKQ-USAGE.md to ensure latest version, (3) avoids duplicate @WRKQ-USAGE.md in CLAUDE.md, (4) adds @WRKQ-USAGE.md to AGENTS.md if it exists. File update operations now run on both new and existing databases.","created_at":"2025-11-30 18:26:47","etag":1,"id":"C-00002","task_uuid":"5e0013db-5352-43c6-bdd1-4635d2999fb1"},"3346a0ed-5589-4087-8175-263cbc502fa5":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Completed CLI bootstrap consolidation:\n\n**Created appctx package** (internal/cli/appctx):\n- App struct holds Config, DB, ActorUUID, ActorID\n- Options struct with NeedsDB and NeedsActor flags\n- DefaultOptions() for read-only commands\n- WithActor() for write commands requiring actor attribution\n- WithApp() wrapper that handles config load, --db override, DB open, and actor resolution\n\n**Migrated wrkq commands**:\n- Read-only: ls, tree, find, stat, log, diff, whoami, watch, comment_cat, cat\n- Write: touch, set, mkdir, mv, rm, rmdir, restore, cp, edit, apply, comment_add, comment_rm, attach (all subcommands)\n\n**Migrated wrkqadm commands**:\n- stateadm (export, import, verify)\n- actorsadm (ls, add)\n\n**Fixed issues**:\n- Changed error message from TODO_ACTOR to WRKQ_ACTOR\n- Updated integration tests to use new appctx pattern\n- Added deprecation notice to old resolveCurrentActor helper\n\n**Note**: Some admin commands (init, bundle, doctor, db, config, patch, attachadm) retain their original patterns due to special requirements (e.g., init creates DB rather than opening existing one).\n\nAll tests pass. Both binaries build successfully.","created_at":"2025-12-03 16:55:16","etag":1,"id":"C-00013","task_uuid":"1a0850e5-58dd-4f8c-8db1-a5496cfd81e5"},"3eaf023d-acb9-4de5-9ac9-02a807e33996":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Completed: updated WRKQ-USAGE.md multi-line -d examples for touch and set; docs-only change, no tests run.","created_at":"2025-11-30 18:57:15","etag":1,"id":"C-00004","task_uuid":"08ada2b3-e594-43e7-ae19-93e2d60e743d"},"44971fca-8623-4e71-9c2c-ebb9d05df93a":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Completed SQL-based cursor pagination implementation:\n\n1. Added cursor.Apply() helper with ApplyOptions/ApplyResult structs\n2. Added cursor.BuildNextCursor() helper for generating next cursors\n3. Added SQLFields support for table-qualified column names in JOINs\n4. Migrated all pagination-using commands:\n   - log.go: ORDER BY e.id DESC\n   - attach.go: ORDER BY a.created_at ASC  \n   - comment.go: ORDER BY c.{sortField} (configurable)\n   - find.go: tasks by updated_at DESC, containers by path ASC\n   - ls.go: ORDER BY slug ASC\n\nAll tests pass. Pagination now happens in SQL rather than in-memory.","created_at":"2025-12-03 18:24:41","etag":1,"id":"C-00017","task_uuid":"a54c46d2-b8ee-41eb-bbff-3845bb399869"},"49a69dcd-c856-4ad1-a908-da17f1d0daf8":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Completed. Added shared path resolution helpers to internal/selectors:\n- WalkContainerPath: walks full container path\n- ResolveParentContainer: resolves parent and returns normalized slug\n- WalkContainerSegment: resolves single segment\n- LookupContainerSegment: existence check without error\n- ResolveTaskByPath: task resolution via path\n\nMigrated 6 commands to use new resolvers:\n- mkdir.go: uses LookupContainerSegment and ResolveParentContainer\n- touch.go: uses ResolveParentContainer\n- ls.go: uses WalkContainerPath and ResolveTaskByPath\n- tree.go: uses WalkContainerPath (removed local resolveContainerPath)\n- mv.go: uses ResolveParentContainer for destination paths\n- cp.go: uses ResolveContainer (simplified resolveDestinationContainer)\n\nAll tests pass. Error messages are now consistent across commands.","created_at":"2025-12-03 17:06:14","etag":1,"id":"C-00015","task_uuid":"265b2780-0f26-4974-9308-166580a33438"},"5c88b42b-3275-4dae-a4bc-5bf55065856b":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Closed. All resolver unification work committed in e49294f.","created_at":"2025-12-06 03:32:19","etag":1,"id":"C-00019","task_uuid":"265b2780-0f26-4974-9308-166580a33438"},"7c7d4cfe-bf97-4c8d-8089-0f6bb184d3aa":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Implemented appctx package with App/Options structs, Bootstrap(), and WithApp() wrapper. Fixed error messages from TODO_ACTOR to WRKQ_ACTOR in 5 files. Migrated cat.go and touch.go as sample conversions. Added comprehensive tests for appctx. Remaining commands can be migrated incrementally.","created_at":"2025-12-03 16:30:02","etag":1,"id":"C-00012","task_uuid":"1a0850e5-58dd-4f8c-8db1-a5496cfd81e5"},"8fc2def4-6fd1-41ca-a03d-78e4c952509f":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Completed patch rebase with auto-renumber implementation.\n\nFiles created:\n- internal/patch/rebase.go - Core rebase logic with friendly ID auto-renumber\n\nFeatures:\n- Computes branch state by applying patch to old-base\n- Detects new entities (actors, containers, tasks, comments)\n- Auto-renumbers colliding friendly IDs using width-preserving increment\n- Outputs rebased patch via diff(new-base, rebased state)\n- --strict-ids flag to fail on malformed IDs\n- --json output includes code_rewrites map\n\nTests added:\n- TestIncrementFriendlyID (5 sub-tests)\n- TestFindNewEntities\n- TestRebase_NoCollision\n- TestRebase_WithCollision\n\nAll tests passing.","created_at":"2025-11-30 21:15:46","etag":1,"id":"C-00007","task_uuid":"cd114f93-2927-4566-ad7f-12c4c1cab26c"},"a70d8a3e-03f4-452d-a04d-c6b8495d5409":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Completed implementation of canonical state snapshot export/import/verify.\n\n**Files created:**\n- `internal/snapshot/types.go` - Snapshot data structures per PATCH-MODE.md §2.2\n- `internal/snapshot/canonical.go` - JCS canonicalization (sorted keys, no whitespace, sorted arrays)\n- `internal/snapshot/export.go` - DB to canonical JSON snapshot\n- `internal/snapshot/import.go` - Snapshot to DB hydration, verification\n- `internal/cli/stateadm.go` - CLI commands: `wrkqadm state export`, `import`, `verify`\n- `internal/snapshot/snapshot_test.go` - Tests for all snapshot functionality\n\n**Features:**\n- Export produces deterministic canonical JSON with sha256 snapshot_rev\n- Labels and UUIDs sorted for determinism\n- Import with --dry-run, --if-empty, --force, --json flags\n- Verify confirms round-trip byte equality (exit 4 on failure)\n- FK validation during import\n\nAll tests passing. Ready for T-00005 (patch pipeline).","created_at":"2025-11-30 19:09:01","etag":1,"id":"C-00005","task_uuid":"25414357-ed78-4aaf-bcb9-b56ee3b1a980"},"b07ad81b-7548-4c47-b833-a39d2407d509":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Completed documentation updates for patch-first workflow.\n\nAdded to docs/PATCH-MODE.md:\n\n**Section 6.4 - Pre-Commit Hook Example**\n- Complete bash script for .git/hooks/pre-commit\n- Verifies snapshot round-trip\n- Checks patch matches current diff\n- Validates patch against base\n\n**Section 6.5 - Exit Codes Reference**\n- Exit code table (0: success, 1: IO/DB, 2: usage, 4: conflict/validation)\n- CI script example with case statement for error handling\n\n**Section 6.6 - GitHub Actions CI Example**\n- Complete workflow YAML for PR validation\n- Snapshot verification, patch validation, dry-run apply\n- PR summary generation using patch summarize\n\n**Section 7.2 - Adoption Steps**\n- Step-by-step guide for enabling patch-first mode\n- Directory structure setup\n- Pre-commit hook installation\n- Team workflow documentation\n\n**Section 7.3 - Common Commands Cheatsheet**\n- Quick reference for all patch commands\n- Export, verify, create, validate, apply, rebase, summarize","created_at":"2025-11-30 21:20:50","etag":1,"id":"C-00009","task_uuid":"4caa8a16-31c1-4843-9d0d-fbfb0a1e854d"},"b5bfa9f4-230a-467b-b1ab-9fcc904e4dac":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Implemented store layer (internal/store) with TaskStore and ContainerStore.\n\nKey changes:\n- Created internal/store/store.go with base Store type and withTx helper\n- Created internal/store/tasks.go with TaskStore: Create, UpdateFields, Move, Archive, Purge, GetAttachments, GetByUUID\n- Created internal/store/containers.go with ContainerStore: Create, UpdateFields, Move, Archive, Delete, GetByUUID, LookupBySlugAndParent\n\nMigrated CLI commands:\n- touch.go now uses TaskStore.Create\n- set.go now uses TaskStore.UpdateFields  \n- mkdir.go now uses ContainerStore.Create\n- rm.go now uses TaskStore.Archive/Purge\n- mv.go now uses TaskStore.Move/UpdateFields and ContainerStore.Move/UpdateFields\n\nAll existing tests pass. Added comprehensive tests in store_test.go covering all store methods.","created_at":"2025-12-03 18:11:53","etag":1,"id":"C-00016","task_uuid":"1d07efa8-7981-4caf-b322-420bb7878bb7"},"bb8273a4-4ae6-4953-8cf2-0eeadb29fe58":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Updated WRKQ-USAGE examples to demonstrate multi-line descriptions with -d in touch and set commands.","created_at":"2025-11-30 18:57:10","etag":1,"id":"C-00003","task_uuid":"08ada2b3-e594-43e7-ae19-93e2d60e743d"},"c7ff2327-af65-49b5-a758-12db6b2c303f":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Drafted refactoring recommendations and saved them to REFACTOR.md. Focus areas: shared CLI bootstrap, path/selector reuse, store layer with events/etag, SQL-backed pagination, admin/user command dedupe, validation utilities, event payload helpers.","created_at":"2025-12-03 16:20:05","etag":1,"id":"C-00011","task_uuid":"e596575a-b1bb-4668-955d-5d5ea47794b9"},"ccda1edc-a6d3-465c-bd00-abe4fa273ac2":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Started codebase review; skimmed CLI commands and helper packages to spot duplication around config/db bootstrapping, path resolution, pagination, and admin/user command duplication. Preparing REFACTOR.md recommendations.","created_at":"2025-12-03 16:19:12","etag":1,"id":"C-00010","task_uuid":"e596575a-b1bb-4668-955d-5d5ea47794b9"},"dc0311e4-1ec6-4623-a851-e206db1363e9":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Completed patch summarize implementation.\n\nFiles created:\n- internal/patch/summarize.go - Summary generation logic\n\nFeatures:\n- Three output formats: text, markdown, json\n- Optional --base snapshot for enriched context (titles, paths)\n- Groups operations by entity type with counts\n- Markdown table format with Entity, Op, ID, Path/Title columns\n- Deterministic ordering (sorted by entity type, then operation, then UUID)\n\nTests added:\n- TestSummarize_TextFormat\n- TestSummarize_MarkdownFormat  \n- TestSummarize_JSONFormat\n- TestSummarize_WithBase\n- TestSummarize_EmptyPatch\n- TestSummarize_DeterministicOrder\n\nAll tests passing.","created_at":"2025-11-30 21:19:17","etag":1,"id":"C-00008","task_uuid":"d773bfbd-771e-4038-ac8f-090216fca8bf"},"e55c243d-5a16-49ba-a42b-6b6cbb4ec9d6":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Completed implementation and testing.\n\nChanges made:\n1. Created internal/cli/embedded/ directory for packaged files\n2. Copied WRKQ-USAGE.md to embedded directory\n3. Added embed directive to initadm.go to package WRKQ-USAGE.md\n4. Implemented writeWrkqUsage() to write WRKQ-USAGE.md to project directory\n5. Implemented updateClaudeMd() to add @WRKQ-USAGE.md reference to CLAUDE.md\n\nBehavior:\n- writeWrkqUsage() only writes if file doesn't exist (won't overwrite)\n- updateClaudeMd() creates CLAUDE.md if missing\n- updateClaudeMd() inserts reference after main heading if exists\n- updateClaudeMd() won't add duplicate reference if already present\n\nTest results:\n✓ New project gets both WRKQ-USAGE.md and CLAUDE.md created\n✓ Existing WRKQ-USAGE.md is not overwritten\n✓ Existing CLAUDE.md gets reference added after main heading\n✓ Reference not duplicated on subsequent runs\n✓ Build succeeds with embedded file","created_at":"2025-11-23 18:28:13","etag":1,"id":"C-00001","task_uuid":"83f16658-c686-4d79-962b-eb770cf60826"},"f59bd7a1-8989-4999-9647-58a8b5ae27b2":{"actor_uuid":"4bcea916-b986-4c98-a96a-4e6204633a8c","body":"Starting implementation. Plan:\n1. Add ResolveContainerPath/ResolveTaskPath helpers to internal/selectors\n2. Extract shared path walk logic with consistent error messages\n3. Migrate commands: mkdir, touch, ls, tree, mv, cp\n4. Ensure all tests pass","created_at":"2025-12-03 17:00:02","etag":1,"id":"C-00014","task_uuid":"265b2780-0f26-4974-9308-166580a33438"}}}